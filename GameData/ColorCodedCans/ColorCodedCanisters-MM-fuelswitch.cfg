
//--------------------------------------------------------------------------------
// Set up the tank types we use, if B9 is installed:

B9_TANK_TYPE:NEEDS[B9PartSwitch]
{
	name = CCCOxidizer
	tankMass = 0.000125
	tankCost = 0.0
	RESOURCE
	{
		name = Oxidizer
		unitsPerVolume = 1
	}
}
B9_TANK_TYPE:NEEDS[B9PartSwitch]
{
	name = CCCLiquidFuel
	tankMass = 0.000125
	tankCost = 0.0
	RESOURCE
	{
		name = LiquidFuel
		unitsPerVolume = 1
	}
}
B9_TANK_TYPE:NEEDS[B9PartSwitch]
{
	name = CCCLFO
	tankMass = 0.000125
	tankCost = 0.0
	RESOURCE
	{
		name = LiquidFuel
		unitsPerVolume = 0.45
	}
	RESOURCE
	{
		name = Oxidizer
		unitsPerVolume = 0.55
	}
}
B9_TANK_TYPE:NEEDS[B9PartSwitch]
{
	name = CCCMonoPropellant
	tankMass = 0.0004
	tankCost = 1.25
	RESOURCE
	{
		name = MonoPropellant
		unitsPerVolume = 1.175
	}
}


//--------------------------------------------------------------------------------
// Mark tanks to be updated:

@PART[miniFuelTank|fuelTankSmallFlat|Size3LargeTank|Size3MediumTank|Size3SmallTank|fuelTank4-2|fuelTank3-2|fuelTank2-2|fuelTank1-2|fuelTank_long|fuelTank|fuelTankSmall]:HAS[@RESOURCE[LiquidFuel],@RESOURCE[Oxidizer],!MODULE[InterstellarFuelSwitch],!MODULE[FSfuelSwitch],!MODULE[ModuleB9PartSwitch]]:NEEDS[Firespitter|InterstellarFuelSwitch|B9PartSwitch&!CryoTanks&!modularFuelTanks&!RealFuels]:BEFORE[ColorCodedCans]
{
	%CCCswitch = True
}

//--------------------------------------------------------------------------------
// Bulk update tanks with Firespitter or InterstellarFuelSwitch:

@PART[*]:HAS[#CCCswitch[*rue],@RESOURCE[LiquidFuel],@RESOURCE[Oxidizer],!MODULE[InterstellarFuelSwitch],!MODULE[FSfuelSwitch],!MODULE[ModuleB9PartSwitch]]:NEEDS[Firespitter|InterstellarFuelSwitch&!CryoTanks&!modularFuelTanks&!RealFuels]:FOR[ColorCodedCans]
{
	%LF = #$RESOURCE[LiquidFuel]/maxAmount$
	%OX = #$RESOURCE[Oxidizer]/maxAmount$

	%LF2 = #$LF$
	@LF2 *= 2
	%OX2 = #$OX$
	@OX2 *= 2

	%Monoprop = #$mass$
	@Monoprop *= 1880

	MODULE
	{
		name:NEEDS[!InterstellarFuelSwitch] = FSfuelSwitch
		name:NEEDS[InterstellarFuelSwitch] = InterstellarFuelSwitch
		volumeMultiplier:NEEDS[InterstellarFuelSwitch] = 1
		massMultiplier:NEEDS[InterstellarFuelSwitch] = 1
		tankSwitchNames:NEEDS[InterstellarFuelSwitch] = LF+OX;LiquidFuel;Oxidizer;MonoProp
		resourceGui:NEEDS[InterstellarFuelSwitch] = LiquidFuel+Oxidizer;LiquidFuel;Oxidizer;MonoPropellant
		resourceNames = LiquidFuel,Oxidizer;LiquidFuel;Oxidizer;MonoPropellant
		resourceAmounts = #$../LF$,$../OX$;$../LF2$;$../OX2$;$../Monoprop$
		tankTechReq:NEEDS[InterstellarFuelSwitch] = start;start;start;advFuelSystems
		basePartMass = #$../mass$
	}
	!RESOURCE[LiquidFuel] {}
	!RESOURCE[Oxidizer] {}
}


//--------------------------------------------------------------------------------
// Bulk update tanks with B9PartSwitch:

@PART[*]:HAS[#CCCswitch[*rue],@RESOURCE[LiquidFuel],@RESOURCE[Oxidizer],!MODULE[InterstellarFuelSwitch],!MODULE[FSfuelSwitch],!MODULE[ModuleB9PartSwitch]]:NEEDS[B9PartSwitch&!Firespitter&!InterstellarFuelSwitch&!CryoTanks&!ModularFuelTanks&!RealFuels]:FOR[ColorCodedCans]
{
	%totalCap = #$RESOURCE[LiquidFuel]/maxAmount$
	@totalCap += #$RESOURCE[Oxidizer]/maxAmount$

	%massOffset = #$mass$
	@massOffset *= -1

	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = fuelSwitch
		switcherDescription = Tank Type
		baseVolume = #$../totalCap$

		SUBTYPE
		{
			name = LF/O
			tankType = CCCLFO
			addedMass = #$../../massOffset$
		}
		SUBTYPE
		{
			name = LiquidFuel
			tankType = CCCLiquidFuel
			addedMass = #$../../massOffset$
		}
		SUBTYPE
		{
			name = Oxidizer
			tankType = CCCOxidizer
			addedMass = #$../../massOffset$
		}
		SUBTYPE
		{
			name = MonoPropellant
			tankType = CCCMonoPropellant
			addedMass = #$../../massOffset$
		}
	}
	!RESOURCE[LiquidFuel] {}
	!RESOURCE[Oxidizer] {}
}

//--------------------------------------------------------------------------------
// Delete temporary variables:


@PART[*]:HAS[#CCCswitch[*rue]]:FOR[zColorCodedCans]
{
	!LF = 0
	!OX = 0
	!LF2 = 0
	!OX2 = 0
	!totalCap = 0
	!massOffset = 0
	!Xenon = 0
	!Monoprop = 0
	!XenonMass = 0
	!Ore = 0
	!OreMass = 0
	!massOffset = 0
}



